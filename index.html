<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Calculadora de Impacto y Desv√≠o de Meteoritos</title>
<style>
body{
  font-family: Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial; 
  background: linear-gradient(135deg, #0a0e27 0%, #1a1f3a 100%); 
  color:#e6eef6; 
  margin:0; 
  padding:24px;
  min-height:100vh;
}
.container{max-width:1400px;margin:0 auto}
.header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:20px;
  flex-wrap:wrap;
  gap:16px;
}
h1{
  font-size:2rem;
  margin:0 0 8px 0;
  background: linear-gradient(90deg,#ca4d05,#e75c0c);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}
.lang-selector{
  display:flex;
  gap:8px;
  background:rgba(15,23,42,0.6);
  padding:8px;
  border-radius:10px;
}
.lang-btn{
  background:rgba(255,255,255,0.05);
  border:1px solid rgba(255,255,255,0.1);
  color:#94a3b8;
  padding:8px 16px;
  border-radius:6px;
  cursor:pointer;
  transition:all 0.3s;
  font-weight:500;
}
.lang-btn:hover{
  background:rgba(255,255,255,0.1);
}
.lang-btn.active{
  background:#f35434;
  color:#0a0e27;
  border-color:#d42806;
}
p.lead{color:#94a3b8;margin-top:0;font-size:1.05rem}
.grid{display:grid;grid-template-columns:450px 1fr;gap:24px;margin-top:24px}
@media(max-width:1200px){.grid{grid-template-columns:1fr}}
.results-grid{display:grid;grid-template-columns:1fr 1fr;gap:24px}
@media(max-width:900px){.results-grid{grid-template-columns:1fr}}
.card{
  background:rgba(15,23,42,0.6);
  padding:24px;
  border-radius:16px;
  box-shadow:0 8px 32px rgba(0,0,0,0.4);
  backdrop-filter: blur(10px);
  border:1px solid rgba(255,255,255,0.05);
}
h3{color:#ff550d;font-size:1.3rem;margin-top:0;margin-bottom:16px}
label{
  display:block;
  font-size:0.9rem;
  color:#dca148;
  margin-bottom:8px;
  font-weight:500;
}
input, select{
  width:100%;
  padding:12px;
  border-radius:10px;
  border:1px solid rgba(255,255,255,0.08);
  background: rgba(255,255,255,0.04);
  color:inherit;
  font-size:1rem;
  transition: all 0.3s ease;
  box-sizing:border-box;
}
input:focus, select:focus{
  outline:none;
  border-color:#f35434;
  background: rgba(255,255,255,0.06);
}
.form-group{margin-bottom:16px}
.row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
button{
  background:linear-gradient(90deg,#f35434,#bc7109);
  border:none;
  padding:14px 24px;
  border-radius:12px;
  font-weight:700;
  cursor:pointer;
  color:#042a2f;
  margin-top:16px;
  width:100%;
  font-size:1.05rem;
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}
button:hover{
  transform: translateY(-2px);
  box-shadow: 0 8px 24px rgba(6,182,212,0.3);
}
button:active{transform: translateY(0)}
.results{margin-top:0}
.result-item{
  background:rgba(255,255,255,0.03);
  padding:16px;
  border-radius:10px;
  margin-bottom:12px;
  border-left:3px solid #da7318;
}
.result-item strong{color:#dca148}
.small{font-size:0.9rem;color:#94a3b8}
.note{
  font-size:0.85rem;
  color:#64748b;
  margin-top:12px;
  font-style:italic;
}
ul{margin:8px 0;padding-left:20px}
ul li{margin:4px 0}
.risk-high{color:#ef4444;font-weight:600}
.risk-medium{color:#f59e0b;font-weight:600}
.risk-low{color:#10b981;font-weight:600}
.risk-none{color:#6b7280;font-weight:600}
.loading{
  display:none;
  text-align:center;
  padding:20px;
  color:#06b6d4;
}
.loading.active{display:block}
.spinner{
  border:3px solid rgba(6,182,212,0.1);
  border-top:3px solid #06b6d4;
  border-radius:50%;
  width:40px;
  height:40px;
  animation:spin 1s linear infinite;
  margin:0 auto 12px;
}
@keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
.location-info{
  background:rgba(125,211,252,0.05);
  padding:12px;
  border-radius:8px;
  margin-top:8px;
}
.method-card{
  background:rgba(255,255,255,0.03);
  padding:16px;
  border-radius:10px;
  margin-bottom:16px;
  border-left:3px solid #da7318;
}
.method-card h4{
  color:#dca148;
  margin-top:0;
  margin-bottom:12px;
}
.pros-cons{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:12px;
  margin-top:8px;
}
.pros, .cons{
  background:rgba(255,255,255,0.02);
  padding:12px;
  border-radius:8px;
}
.pros{border-left:3px solid #10b981}
.cons{border-left:3px solid #ef4444}
.pros h5{color:#10b981;margin-top:0;font-size:0.9rem}
.cons h5{color:#ef4444;margin-top:0;font-size:0.9rem}
.pass{color:#22c55e;font-weight:bold}
.fail{color:#f87171;font-weight:bold}
.section-divider{
  border-top:2px solid rgba(255,255,255,0.05);
  margin:20px 0;
  padding-top:8px;
}
</style>
</head>
<body>
<div class="container">
<div class="header">
  <div>
    <h1 id="mainTitle"><img src="logo.png" alt="Icono de meteorito" width="40" height="40" style="vertical-align: middle; margin-right:¬†10px;"> Delta's Madness</h1>
    <p class="lead" id="mainSubtitle">Simulador de impactos mete√≥ricos y estrategias de deflexi√≥n</p>
  </div>
  <div class="lang-selector">
    <button class="lang-btn active" onclick="setLang('es')">Espa√±ol</button>
    <button class="lang-btn" onclick="setLang('en')">English</button>
  </div>
</div>

<div class="grid">
  <!-- COLUMNA IZQUIERDA: PAR√ÅMETROS -->
  <div class="card">
    <h3 id="paramsTitle">‚öôÔ∏è Simulaci√≥n del asteroide</h3>

<div class="form-group">
  <label for="asteroidSearch">Buscar asteroide por nombre:</label>
  <input id="asteroidSearch" type="text" placeholder="Ejemplo: Geographos" />
  <button id="searchAsteroidBtn">Buscar</button>
</div>
<ul id="asteroidResults"></ul>
    <div class="form-group">
          <h3 id="paramsTitle">‚öôÔ∏è Asteroide personalizado</h3>

      <div class="form-group">
  <label id="labelDiameter">Di√°metro (m)</label>
  <input id="diameter" type="number" value="100" min="1" step="0.1" />
</div>

<div class="form-group">
  <label id="labelType">Tipo de objeto</label>
  <select id="objectType">
    <option value="rocky" id="optionRocky">Rocoso (asteroide tipo S)</option>
    <option value="metallic" id="optionMetallic">Met√°lico (asteroide tipo M)</option>
    <option value="cometary" id="optionCometary">Cometario (hielo y roca)</option>
  </select>
</div>

<div class="form-group">
  <label id="labelVelocity">Velocidad (m/s)</label>
  <input id="velocity" type="number" value="20000" min="100" />
</div>

<div class="form-group">
  <label id="labelAngle">√Ångulo de entrada (¬∞)</label>
  <input id="angle" type="number" value="45" min="0" max="90" />
</div>
    </div>

    <div class="form-group">
      <label id="labelGravity">Gravedad local (m/s¬≤)</label>
      <input id="g" type="number" value="9.81" step="0.01" />
    </div>

    <div class="section-divider"></div>
    <h3 id="locationTitle">üìç Ubicaci√≥n del Impacto</h3>
    
    <div class="row">
      <div class="form-group">
        <label id="labelLat">Latitud</label>
        <input id="lat" type="number" value="19.43" step="0.01" min="-90" max="90" />
      </div>
      <div class="form-group">
        <label id="labelLon">Longitud</label>
        <input id="lon" type="number" value="-99.13" step="0.01" min="-180" max="180" />
      </div>
    </div>

    <div class="section-divider"></div>
    <h3 id="deflectionTitle">üõ∞Ô∏è Par√°metros de Desv√≠o</h3>

    <div class="form-group">
      <label id="labelTime">Tiempo antes del impacto (a√±os)</label>
      <input id="timeYears" type="number" value="10" min="0.1" step="0.1" />
    </div>

    <div class="form-group">
      <label id="labelDisplacement">Desplazamiento requerido (m)</label>
      <input id="displacement" type="number" value="6371000" />
    </div>

    <div class="form-group">
      <label id="labelChoice">M√©todo de c√°lculo de nave:</label>
      <select id="calcMethod">
        <option value="v" id="optionVel">Especificar velocidad de impacto (m/s)</option>
        <option value="m" id="optionMass">Especificar masa de la nave (kg)</option>
      </select>
    </div>

    <div class="form-group">
      <label id="labelInputVal">Valor de la nave</label>
      <input id="spacecraftValue" type="number" value="6000" />
    </div>

    <button id="calcBtn">üöÄ Calcular Todo</button>
    <div class="note" id="note"></div>
  </div>

  <!-- COLUMNA DERECHA: RESULTADOS -->
  <div>
    
    <div class="card">
      <h3 id="earthtitle">üåé Planeta Tierra</h3>
            <div id="container"></div>
        </div>
      </div>
    </div>
    <div class="results-grid">

      <!-- RESULTADOS DE IMPACTO -->
      <div class="card" style="margin-top:24px">
        
        <h3 id="impactResultsTitle">üí• An√°lisis de Impacto</h3>
        <div class="loading" id="loadingImpact">
          <div class="spinner"></div>
          <div id="loadingText">Analizando...</div>
        </div>
        <div id="impactResults" class="results">
          <div class="small" id="impactPlaceholder">Presiona <strong>üöÄ Calcular Todo</strong> para ver resultados.</div>
        
        </div>
      </div>

      <!-- RESULTADOS DE DESV√çO -->
      <div class="card" style="margin-top:24px">
        <h3 id="deflectionResultsTitle">üõ∞Ô∏è An√°lisis de Desv√≠o</h3>
        <div class="loading" id="loadingDeflection">
          <div class="spinner"></div>
          <div id="loadingText2">Analizando...</div>
        </div>
        <div id="deflectionResults" class="results">
          <div class="small" id="deflectionPlaceholder">Presiona <strong>üöÄ Calcular Todo</strong> para ver resultados.</div>
        </div>
      </div>
    </div>

    <!-- COMPARACI√ìN DE M√âTODOS -->
    <div class="card" style="margin-top:24px">

      <h3 id="methodsTitle">‚öñÔ∏è Comparaci√≥n de M√©todos de Desv√≠o</h3>
      <div id="methodsComparison">
        <div class="small" id="methodsPlaceholder">Los m√©todos se mostrar√°n despu√©s del c√°lculo.</div>
      </div>
    </div>
  </div>
</div>

</div>

<script>
let currentLang = 'es';

const translations = {
  es: {
    mainTitle: 'Delta¬¥s Madness',
    mainSubtitle: 'Simulador de impactos mete√≥ricos y estrategias de deflexi√≥n',
    paramsTitle: '‚öôÔ∏è Par√°metros del Meteorito/Asteroide',
    labelDiameter: 'Di√°metro (m)',
    labelType: 'Tipo de objeto',
    optionRocky: 'Rocoso (asteroide tipo S)',
    optionMetallic: 'Met√°lico (asteroide tipo M)',
    optionCometary: 'Cometario (hielo y roca)',
    labelVelocity: 'Velocidad (m/s)',
    labelAngle: '√Ångulo de entrada (¬∞)',
    labelGravity: 'Gravedad local (m/s¬≤)',
    locationTitle: 'üìç Ubicaci√≥n del Impacto',
    labelLat: 'Latitud',
    labelLon: 'Longitud',
    deflectionTitle: 'üõ∞Ô∏è Par√°metros de Desv√≠o',
    labelTime: 'Tiempo antes del impacto (a√±os)',
    labelDisplacement: 'Desplazamiento requerido (m)',
    labelChoice: 'M√©todo de c√°lculo de nave:',
    optionVel: 'Especificar velocidad de impacto (m/s)',
    optionMass: 'Especificar masa de la nave (kg)',
    labelInputVal: 'Valor de la nave',
    calcBtn: 'üöÄ Calcular Todo',
    note: '',
    earthtitle: 'üåé Planeta Tierra',
    impactResultsTitle: 'üí• An√°lisis de Impacto',
    deflectionResultsTitle: 'üõ∞Ô∏è An√°lisis de Desv√≠o',
    methodsTitle: '‚öñÔ∏è Comparaci√≥n de M√©todos de Desv√≠o',
    loadingText: 'Analizando...',
    impactPlaceholder: 'Presiona <strong>üöÄ Calcular Todo</strong> para ver resultados.',
    deflectionPlaceholder: 'Presiona <strong>üöÄ Calcular Todo</strong> para ver resultados.',
    methodsPlaceholder: 'Los m√©todos se mostrar√°n despu√©s del c√°lculo.',
    targetDensity: 'üåç Densidad del objetivo:',
    energyReleased: 'üí• Energ√≠a liberada:',
    craterDiameter: 'üï≥Ô∏è Di√°metro del cr√°ter:',
    airblast: 'üå™Ô∏è Onda expansiva',
    thermalRadiation: 'üî• Radiaci√≥n t√©rmica',
    ejecta: 'ü™® Eyecci√≥n de material',
    impactLocation: 'üìç Ubicaci√≥n del impacto:',
    riskAssessment: '‚ö†Ô∏è Riesgos Secundarios',
    kinetic: 'Impacto Cin√©tico',
    ablation: 'Ablaci√≥n L√°ser/Solar',
    advantages: 'Ventajas',
    disadvantages: 'Desventajas',
    kineticAdvantages: 'Tecnolog√≠a madura, efecto inmediato',
    kineticDisadvantages: 'Requiere precisi√≥n extrema, riesgo de fragmentaci√≥n, alto costo',
    ablationAdvantages: 'Empuje continuo, menor masa de nave',
    ablationDisadvantages: 'Necesita mucha potencia, dif√≠cil enfoque, efecto lento',
    results: 'Resultados',
    proposal: 'Propuesta de nave',
    meets: 'Cumple Œîv',
    notMeets: 'No cumple Œîv',
    source: 'Fuente',
    equivalent: 'Equivalente a',
    hiroshimaBombs: 'bombas como la de Hiroshima',
    radius: 'Radio de',
    estimatedDepth: 'profundidad estimada',
    range: 'Alcance',
    rockyMaterial: 'Material rocoso lanzado por el impacto',
    coordinates: 'Coordenadas',
    ecosystem: 'Ecosistema',
    earthquake: 'Terremoto',
    fires: 'Incendios',
    estimatedQuakes: 'sismos estimados',
    required: 'requerida',
    safety: 'de seguridad',
    kineticEnergy: 'Energ√≠a cin√©tica',
    achieved: 'alcanzada',
    with: 'con',
    years: 'a√±os',
    meters: 'metros',
    megatonsTNT: 'Megatones TNT'
  },
  en: {
    mainTitle: 'Delta¬¥s Madness',
    mainSubtitle: 'Simulator for meteor impacts and deflection strategies',
    paramsTitle: '‚öôÔ∏è Meteor/Asteroid Parameters',
    labelDiameter: 'Diameter (m)',
    labelType: 'Object type',
    optionRocky: 'Rocky (S-type asteroid)',
    optionMetallic: 'Metallic (M-type asteroid)',
    optionCometary: 'Cometary (ice and rock)',
    labelVelocity: 'Velocity (m/s)',
    labelAngle: 'Entry angle (¬∞)',
    labelGravity: 'Local gravity (m/s¬≤)',
    locationTitle: 'üìç Impact Location',
    labelLat: 'Latitude',
    labelLon: 'Longitude',
    deflectionTitle: 'üõ∞Ô∏è Deflection Parameters',
    labelTime: 'Time before impact (years)',
    labelDisplacement: 'Required displacement (m)',
    labelChoice: 'Spacecraft calculation method:',
    optionVel: 'Specify impact velocity (m/s)',
    optionMass: 'Specify spacecraft mass (kg)',
    labelInputVal: 'Spacecraft value',
    calcBtn: 'üöÄ Calculate All',
    note: '',
    earthtitle: 'üåé Planet Earth',
    impactResultsTitle: 'üí• Impact Analysis',
    deflectionResultsTitle: 'üõ∞Ô∏è Deflection Analysis',
    methodsTitle: '‚öñÔ∏è Deflection Methods Comparison',
    loadingText: 'Analyzing...',
    impactPlaceholder: 'Press <strong>üöÄ Calculate All</strong> to see results.',
    deflectionPlaceholder: 'Press <strong>üöÄ Calculate All</strong> to see results.',
    methodsPlaceholder: 'Methods will be shown after calculation.',
    targetDensity: 'üåç Target density:',
    energyReleased: 'üí• Energy released:',
    craterDiameter: 'üï≥Ô∏è Crater diameter:',
    airblast: 'üå™Ô∏è Airblast',
    thermalRadiation: 'üî• Thermal radiation',
    ejecta: 'ü™® Ejecta material',
    impactLocation: 'üìç Impact location:',
    riskAssessment: '‚ö†Ô∏è Secondary Risks',
    kinetic: 'Kinetic Impact',
    ablation: 'Laser/Solar Ablation',
    advantages: 'Advantages',
    disadvantages: 'Disadvantages',
    kineticAdvantages: 'Mature technology, immediate effect',
    kineticDisadvantages: 'Requires extreme precision, fragmentation risk, high cost',
    ablationAdvantages: 'Continuous thrust, lighter spacecraft',
    ablationDisadvantages: 'Needs high power, hard to focus, slow effect',
    results: 'Results',
    proposal: 'Spacecraft proposal',
    meets: 'Meets Œîv',
    notMeets: 'Does not meet Œîv',
    source: 'Source',
    equivalent: 'Equivalent to',
    hiroshimaBombs: 'Hiroshima-sized bombs',
    radius: 'Radius',
    estimatedDepth: 'estimated depth',
    range: 'Range',
    rockyMaterial: 'Rock material ejected by impact',
    coordinates: 'Coordinates',
    ecosystem: 'Ecosystem',
    earthquake: 'Earthquake',
    fires: 'Fires',
    estimatedQuakes: 'estimated quakes',
    required: 'required',
    safety: 'safety',
    kineticEnergy: 'Kinetic energy',
    achieved: 'achieved',
    with: 'with',
    years: 'years',
    meters: 'meters',
    megatonsTNT: 'Megatons TNT'
  }
};

function setLang(lang) {
  currentLang = lang;
  document.querySelectorAll('.lang-btn').forEach(btn => btn.classList.remove('active'));
  event.target.classList.add('active');
  updateTranslations();
}

function updateTranslations() {
  const t = translations[currentLang];
  document.getElementById('mainTitle').innerHTML = `<img src="logo.png" alt="Icono de meteorito" width="40" height="40" style="vertical-align: middle; margin-right:10px;"> ${t.mainTitle}`;
  document.getElementById('mainSubtitle').textContent = t.mainSubtitle;
  document.getElementById('paramsTitle').textContent = t.paramsTitle;
  document.getElementById('labelDiameter').textContent = t.labelDiameter;
  document.getElementById('labelType').textContent = t.labelType;
  document.getElementById('optionRocky').textContent = t.optionRocky;
  document.getElementById('optionMetallic').textContent = t.optionMetallic;
  document.getElementById('optionCometary').textContent = t.optionCometary;
  document.getElementById('labelVelocity').textContent = t.labelVelocity;
  document.getElementById('labelAngle').textContent = t.labelAngle;
  document.getElementById('labelGravity').textContent = t.labelGravity;
  document.getElementById('locationTitle').textContent = t.locationTitle;
  document.getElementById('labelLat').textContent = t.labelLat;
  document.getElementById('labelLon').textContent = t.labelLon;
  document.getElementById('deflectionTitle').textContent = t.deflectionTitle;
  document.getElementById('labelTime').textContent = t.labelTime;
  document.getElementById('labelDisplacement').textContent = t.labelDisplacement;
  document.getElementById('labelChoice').textContent = t.labelChoice;
  document.getElementById('optionVel').textContent = t.optionVel;
  document.getElementById('optionMass').textContent = t.optionMass;
  document.getElementById('labelInputVal').textContent = t.labelInputVal;
  document.getElementById('calcBtn').textContent = t.calcBtn;
  document.getElementById('note').textContent = t.note;
  document.getElementById('earthtitle').textContent = t.earthtitle;
  document.getElementById('impactResultsTitle').textContent = t.impactResultsTitle;
  document.getElementById('deflectionResultsTitle').textContent = t.deflectionResultsTitle;
  document.getElementById('methodsTitle').textContent = t.methodsTitle;
  document.getElementById('loadingText').textContent = t.loadingText;
  document.getElementById('loadingText2').textContent = t.loadingText;
  document.getElementById('impactPlaceholder').innerHTML = t.impactPlaceholder;
  document.getElementById('deflectionPlaceholder').innerHTML = t.deflectionPlaceholder;
  document.getElementById('methodsPlaceholder').textContent = t.methodsPlaceholder;
}

function toNumber(id){return Number(document.getElementById(id).value)}

function getSoilDensityByEcosystem(ecosystemData){
  const eco = ecosystemData?.type || '';
  
  if(eco.includes('Oc√©ano') || eco.includes('Ocean')){
    return {density: 1030, source: currentLang === 'es' ? 'Agua oce√°nica (1030 kg/m¬≥)' : 'Ocean water (1030 kg/m¬≥)'};
  }
  
  if(eco.includes('Polar') || eco.includes('Tundra')){
    return {density: 1800, source: currentLang === 'es' ? 'Suelo de tundra/permafrost (1800 kg/m¬≥)' : 'Tundra/permafrost soil (1800 kg/m¬≥)'};
  }
  
  if(eco.includes('Desierto') || eco.includes('Desert')){
    return {density: 1600, source: currentLang === 'es' ? 'Suelo des√©rtico/arenoso (1600 kg/m¬≥)' : 'Desert/sandy soil (1600 kg/m¬≥)'};
  }
  
  if(eco.includes('boreal') || eco.includes('Taiga')){
    return {density: 1400, source: currentLang === 'es' ? 'Suelo de bosque boreal (1400 kg/m¬≥)' : 'Boreal forest soil (1400 kg/m¬≥)'};
  }
  
  if(eco.includes('tropical') || eco.includes('Tropical')){
    return {density: 1300, source: currentLang === 'es' ? 'Suelo de selva tropical (1300 kg/m¬≥)' : 'Tropical rainforest soil (1300 kg/m¬≥)'};
  }
  
  if(eco.includes('templado') || eco.includes('temperate')){
    return {density: 1500, source: currentLang === 'es' ? 'Suelo de bosque templado (1500 kg/m¬≥)' : 'Temperate forest soil (1500 kg/m¬≥)'};
  }
  
  if(eco.includes('Sabana') || eco.includes('Pradera') || eco.includes('Estepa') || eco.includes('Savanna') || eco.includes('Grassland')){
    return {density: 1450, source: currentLang === 'es' ? 'Suelo de sabana/pradera (1450 kg/m¬≥)' : 'Savanna/grassland soil (1450 kg/m¬≥)'};
  }
  
  if(eco.includes('Subtropical') || eco.includes('mediterr√°neo') || eco.includes('Mediterranean')){
    return {density: 1550, source: currentLang === 'es' ? 'Suelo subtropical/mediterr√°neo (1550 kg/m¬≥)' : 'Subtropical/mediterranean soil (1550 kg/m¬≥)'};
  }
  
  return {density: 2500, source: currentLang === 'es' ? 'Suelo continental promedio (2500 kg/m¬≥)' : 'Average continental soil (2500 kg/m¬≥)'};
}

function getRiskClass(risk){
  const highWords = ['Alto', 'Catastr√≥fico', 'High', 'Catastrophic'];
  const medWords = ['Medio', 'Medium'];
  const lowWords = ['Bajo', 'Low'];
  
  if(highWords.includes(risk)) return 'risk-high';
  if(medWords.includes(risk)) return 'risk-medium';
  if(lowWords.includes(risk)) return 'risk-low';
  return 'risk-none';
}

async function getLocationInfo(lat, lon){
  const countries = [
    {minLat: 14.5, maxLat: 32.7, minLon: -118.4, maxLon: -86.7, name: currentLang === 'es' ? 'M√©xico' : 'Mexico'},
    {minLat: 24.5, maxLat: 49.4, minLon: -125, maxLon: -66.9, name: currentLang === 'es' ? 'Estados Unidos' : 'United States'},
    {minLat: 41.7, maxLat: 83.1, minLon: -141, maxLon: -52.6, name: currentLang === 'es' ? 'Canad√°' : 'Canada'},
    {minLat: 24, maxLat: 46, minLon: 122, maxLon: 146, name: currentLang === 'es' ? 'Jap√≥n' : 'Japan'},
    {minLat: 18, maxLat: 54, minLon: 73, maxLon: 135, name: currentLang === 'es' ? 'China' : 'China'},
  ];

  for(const country of countries){
    if(lat >= country.minLat && lat <= country.maxLat && lon >= country.minLon && lon <= country.maxLon){
      return {address: {country: country.name}, display_name: country.name};
    }
  }

  const isLikelyOcean = (lat < -40 || (Math.abs(lat) < 30 && (lon < -100 || lon > 100)));
  
  if(isLikelyOcean){
    let oceanName = currentLang === 'es' ? 'Oc√©ano Pac√≠fico' : 'Pacific Ocean';
    return {address: {country: oceanName, ocean: oceanName}, display_name: oceanName};
  }

  return {address: {country: currentLang === 'es' ? 'Ubicaci√≥n terrestre' : 'Land location'}, display_name: `${lat.toFixed(2)}¬∞, ${lon.toFixed(2)}¬∞`};
}

async function getEarthquakeRisk(lat, lon){
  const zones = [
    {lat: 19.43, lon: -99.13, total: 45, highMag: 3},
    {minLat: 30, maxLat: 46, minLon: 129, maxLon: 146, total: 80, highMag: 5},
  ];

  for(const z of zones){
    if(z.minLat !== undefined){
      if(lat >= z.minLat && lat <= z.maxLat && lon >= z.minLon && lon <= z.maxLon){
        return {total: z.total, highMag: z.highMag};
      }
    } else if(z.lat !== undefined){
      const d = Math.sqrt(Math.pow(lat - z.lat, 2) + Math.pow(lon - z.lon, 2));
      if(d < 2) return {total: z.total, highMag: z.highMag};
    }
  }

  const absLat = Math.abs(lat);
  if(absLat > 30 && absLat < 60) return {total: 15, highMag: 1};
  if(absLat < 30) return {total: 8, highMag: 0};
  return {total: 5, highMag: 0};
}

function calculateDistanceToCoast(lat, lon, locData){
  if(locData?.address?.ocean || locData?.address?.sea) return 0;
  return 200;
}

function assessTsunamiRisk(craterDiam, energy, lat, lon, locData){
  const dist = calculateDistanceToCoast(lat, lon, locData);
  const isOcean = locData?.address?.ocean || locData?.address?.sea;
  
  const riskWords = currentLang === 'es' 
    ? {none: 'Nulo', low: 'Bajo', medium: 'Medio', high: 'Alto', catastrophic: 'Catastr√≥fico'}
    : {none: 'None', low: 'Low', medium: 'Medium', high: 'High', catastrophic: 'Catastrophic'};
  
  if(dist > 200) return riskWords.none;
  
  if(isOcean){
    if(craterDiam > 3000 && energy > 100) return riskWords.catastrophic;
    if(craterDiam > 2000 || energy > 50) return riskWords.high;
    if(craterDiam > 1000 || energy > 10) return riskWords.medium;
    return riskWords.low;
  }
  
  if(dist < 100 && craterDiam > 1500) return riskWords.high;
  if(dist < 100 && craterDiam > 800) return riskWords.medium;
  if(dist < 100) return riskWords.low;
  
  return riskWords.none;
}

function assessEarthquakeRisk(craterDiam, energy, eqData){
  const {total, highMag} = eqData;
  
  const riskWords = currentLang === 'es' 
    ? {none: 'Nulo', low: 'Bajo', medium: 'Medio', high: 'Alto', catastrophic: 'Catastr√≥fico'}
    : {none: 'None', low: 'Low', medium: 'Medium', high: 'High', catastrophic: 'Catastrophic'};
  
  let base = riskWords.none;
  if(highMag > 5) base = riskWords.high;
  else if(highMag > 2) base = riskWords.medium;
  else if(total > 10) base = riskWords.low;
  
  if(craterDiam > 2000 && energy > 50){
    if(base === riskWords.high) return riskWords.catastrophic;
    if(base === riskWords.medium) return riskWords.high;
    return riskWords.medium;
  }
  
  if(craterDiam > 1000 && energy > 10){
    if(base === riskWords.high) return riskWords.high;
    if(base === riskWords.medium) return riskWords.medium;
    return riskWords.low;
  }
  
  return base;
}

async function getEcosystemType(lat, lon, locData){
  const absLat = Math.abs(lat);
  
  if(locData?.address?.ocean || locData?.address?.sea){
    if(absLat < 10) return {type: currentLang === 'es' ? 'Oc√©ano tropical' : 'Tropical ocean', icon: 'üåä'};
    if(absLat < 30) return {type: currentLang === 'es' ? 'Oc√©ano subtropical' : 'Subtropical ocean', icon: 'üåä'};
    if(absLat < 60) return {type: currentLang === 'es' ? 'Oc√©ano templado' : 'Temperate ocean', icon: 'üåä'};
    return {type: currentLang === 'es' ? 'Oc√©ano polar' : 'Polar ocean', icon: 'üßä'};
  }
  
  if(absLat > 66) return {type: currentLang === 'es' ? 'Tundra/Polar' : 'Tundra/Polar', icon: 'üßä'};
  
  const deserts = [
    {minLat: 15, maxLat: 30, minLon: -17, maxLon: 35},
    {minLat: 20, maxLat: 32, minLon: -117, maxLon: -109},
  ];
  
  for(const desert of deserts){
    if(lat >= desert.minLat && lat <= desert.maxLat && lon >= desert.minLon && lon <= desert.maxLon){
      return {type: currentLang === 'es' ? 'Desierto c√°lido' : 'Hot desert', icon: 'üèúÔ∏è'};
    }
  }
  
  const rainforests = [
    {minLat: -15, maxLat: 5, minLon: -80, maxLon: -50},
    {minLat: -5, maxLat: 5, minLon: 10, maxLon: 30},
  ];
  
  for(const forest of rainforests){
    if(lat >= forest.minLat && lat <= forest.maxLat && lon >= forest.minLon && lon <= forest.maxLon){
      return {type: currentLang === 'es' ? 'Selva tropical' : 'Tropical rainforest', icon: 'üå¥'};
    }
  }
  
  if(absLat > 50 && absLat <= 66){
    return {type: currentLang === 'es' ? 'Bosque boreal/Taiga' : 'Boreal forest/Taiga', icon: 'üå≤'};
  }
  
  if(absLat > 30 && absLat <= 50){
    return {type: currentLang === 'es' ? 'Bosque templado' : 'Temperate forest', icon: 'üå≥'};
  }
  
  if(absLat > 23 && absLat <= 30){
    return {type: currentLang === 'es' ? 'Subtropical' : 'Subtropical', icon: 'üåø'};
  }
  
  if(absLat <= 23){
    return {type: currentLang === 'es' ? 'Tropical' : 'Tropical', icon: 'üå¥'};
  }
  
  return {type: currentLang === 'es' ? 'Terrestre mixto' : 'Mixed terrestrial', icon: 'üåç'};
}

function assessFireRisk(energy, ecosystemData){
  const eco = ecosystemData?.type || '';
  
  const riskWords = currentLang === 'es' 
    ? {none: 'Nulo', low: 'Bajo', medium: 'Medio', high: 'Alto', catastrophic: 'Catastr√≥fico'}
    : {none: 'None', low: 'Low', medium: 'Medium', high: 'High', catastrophic: 'Catastrophic'};
  
  if(eco.includes('Ocean') || eco.includes('Oc√©ano') || eco.includes('Polar')) return riskWords.none;
  
  const high = ['tropical', 'Tropical', 'temperate', 'templado', 'boreal', 'Taiga'];
  const med = ['Sabana', 'Savanna', 'Subtropical'];
  
  const isHigh = high.some(t => eco.includes(t));
  const isMed = med.some(t => eco.includes(t));
  
  if(energy > 100){
    if(isHigh) return riskWords.catastrophic;
    if(isMed) return riskWords.high;
    return riskWords.medium;
  }
  
  if(energy > 20){
    if(isHigh) return riskWords.high;
    if(isMed) return riskWords.medium;
    return riskWords.low;
  }
  
  if(energy > 5){
    if(isHigh) return riskWords.medium;
    return riskWords.low;
  }
  
  return riskWords.none;
}
let allAsteroids = [];

async function fetchAsteroids(pages = 3) {
    allAsteroids = [];
    for (let i = 0; i < pages; i++) {
        const response = await fetch(`/asteroids?page=${i}`);
        if (!response.ok) continue;
        const data = await response.json();
        if (!data) continue;
        allAsteroids = allAsteroids.concat(data.near_earth_objects);
    }
}

// Llama a la funci√≥n al cargar la p√°gina
fetchAsteroids(3);

// Funci√≥n para buscar y mostrar resultados
function searchAsteroids() {
    const query = document.getElementById('asteroidSearch').value.trim().toLowerCase();
    const results = allAsteroids.filter(ast => ast.name.toLowerCase().includes(query));
    const resultsList = document.getElementById('asteroidResults');
    resultsList.innerHTML = '';
    if (results.length === 0) {
        resultsList.innerHTML = '<li>No se encontraron asteroides.</li>';
        return;
    }
    results.forEach(ast => {
        const diamMin = ast.estimated_diameter.kilometers.estimated_diameter_min.toFixed(3);
        const diamMax = ast.estimated_diameter.kilometers.estimated_diameter_max.toFixed(3);
        let distancia = 'N/A';
        if (ast.close_approach_data && ast.close_approach_data.length > 0) {
            distancia = ast.close_approach_data[0].miss_distance.kilometers;
        }
        resultsList.innerHTML += `<li>
            <strong>${ast.name}</strong> | Di√°metro: ${diamMin} - ${diamMax} km | Distancia: ${distancia} km
        </li>`;
    });
}

// Evento para el bot√≥n de b√∫squeda
document.getElementById('searchAsteroidBtn').addEventListener('click', searchAsteroids);
document.getElementById('asteroidSearch').addEventListener('keyup', function(e) {
    if (e.key === 'Enter') searchAsteroids();
});

function toSeconds(years){return years*365.25*24*3600;}
function getObjectDensity(objectType) {
  const densities = {
    rocky: 3000,      // kg/m¬≥ - Asteroides tipo S (silicatos)
    metallic: 7800,   // kg/m¬≥ - Asteroides tipo M (hierro-n√≠quel)
    cometary: 500     // kg/m¬≥ - Cometas (hielo y roca porosa)
  };
  return densities[objectType] || 3000;
}

async function calculateAll(){
  const impactDiv = document.getElementById('impactResults');
  const deflectionDiv = document.getElementById('deflectionResults');
  const loadingImpact = document.getElementById('loadingImpact');
  const loadingDeflection = document.getElementById('loadingDeflection');
  
  loadingImpact.classList.add('active');
  loadingDeflection.classList.add('active');
  impactDiv.innerHTML = '';
  deflectionDiv.innerHTML = '';
  
  try{
    // Obtener par√°metros de entrada
    const d = toNumber('diameter'); // di√°metro en metros
    const objectType = document.getElementById('objectType').value;
    const rho_i = getObjectDensity(objectType); // densidad del objeto
    
    // Calcular volumen y masa del objeto (asumiendo esfera)
    const volume = (Math.PI / 6) * Math.pow(d, 3); // V = (œÄ/6) * d¬≥
    const m = rho_i * volume; // masa = densidad √ó volumen
    
    const v = toNumber('velocity');
    const g = toNumber('g')||9.81;
    const lat = toNumber('lat');
    const lon = toNumber('lon');
    const timeYears = toNumber('timeYears');
    const displacement = toNumber('displacement');
    const calcMethod = document.getElementById('calcMethod').value;
    const spacecraftValue = toNumber('spacecraftValue');

    const t = translations[currentLang];

    // ===== C√ÅLCULOS DE IMPACTO =====
    const locData = await getLocationInfo(lat, lon);
const ecosystemData = await getEcosystemType(lat, lon, locData);
const soilData = getSoilDensityByEcosystem(ecosystemData);
const rho_t = soilData.density;

// Energ√≠a cin√©tica: E = (1/2) * m * v¬≤
const E = 0.5*m*v*v;
const megatonsTNT = E/4.184e15;

// Di√°metro del cr√°ter (f√≥rmula de Schmidt-Holsapple corregida)
// D = 1.161 * d^0.78 * (œÅ_i/œÅ_t)^0.44 * v^0.44 * g^-0.22
const D_final = 1.161 * Math.pow(d, 0.78) * Math.pow(rho_i/rho_t, 0.44) * Math.pow(v, 0.44) * Math.pow(g, -0.22);

// Onda expansiva - Modelo de Glasstone & Dolan para impactos
// R (km) = factor √ó W^(1/3), donde W est√° en kilotones TNT
const W_kilotons = megatonsTNT * 1000;

// Factores de escala para impactos de superficie (en km/kt^(1/3))
const blast_factors = currentLang === 'es' ? {
  '1 psi (ventanas rotas)': 2.2,
  '3 psi (casas da√±adas)': 1.0,
  '5 psi (edificios colapsados)': 0.71,
  '10 psi (concreto reforzado da√±ado)': 0.45,
  '20 psi (destrucci√≥n casi total)': 0.28
} : {
  '1 psi (broken windows)': 2.2,
  '3 psi (houses damaged)': 1.0,
  '5 psi (buildings collapsed)': 0.71,
  '10 psi (reinforced concrete damaged)': 0.45,
  '20 psi (near-total destruction)': 0.28
};

const crater_radius_km = (D_final / 2) / 1000; // Radio del cr√°ter en km

const airblastDistances = {};
for(const k in blast_factors){
  // R = factor √ó W^(1/3), resultado en km
  let distance_km = blast_factors[k] * Math.pow(W_kilotons, 1/3);
  
  // Asegurar que ninguna zona de da√±o sea menor que el radio del cr√°ter
  if(distance_km < crater_radius_km){
    distance_km = crater_radius_km * 1.1; // 50% m√°s all√° del cr√°ter
  }
  
  airblastDistances[k] = distance_km * 1000; // Convertir a metros para display
}

Object.values(airblastDistances)[0];
    const f_rad=0.1,E_rad=E*f_rad;
    function thermalDist(F){return Math.sqrt(E_rad/(4*Math.PI*F));}
    
    const thermalLabels = currentLang === 'es'
      ? {'Quemaduras de 1er grado':20000,'Quemaduras de 3er grado':200000,'Ignici√≥n de materiales':500000}
      : {'1st degree burns':20000,'3rd degree burns':200000,'Material ignition':500000};
    
    const thermal = {};
    for(const k in thermalLabels){thermal[k] = thermalDist(thermalLabels[k]);}

   
    const eqData = await getEarthquakeRisk(lat, lon);
    const tsunamiRisk = assessTsunamiRisk(D_final, megatonsTNT, lat, lon, locData);
    const earthquakeRisk = assessEarthquakeRisk(D_final, megatonsTNT, eqData);
    const fireRisk = assessFireRisk(megatonsTNT, ecosystemData);

    let impactHtml='';

    const typeNames = {
  es: {rocky: 'Rocoso (tipo S)', metallic: 'Met√°lico (tipo M)', cometary: 'Cometario'},
  en: {rocky: 'Rocky (S-type)', metallic: 'Metallic (M-type)', cometary: 'Cometary'}
};
    impactHtml+=`<div class="result-item">
  <strong>${currentLang === 'es' ? '‚òÑÔ∏è Caracter√≠sticas del objeto' : '‚òÑÔ∏è Object characteristics'}</strong>
  <p>${currentLang === 'es' ? 'Tipo' : 'Type'}: ${typeNames[currentLang][objectType]}</p>
  <p>${currentLang === 'es' ? 'Di√°metro' : 'Diameter'}: ${d.toFixed(2)} m</p>
  <p>${currentLang === 'es' ? 'Masa calculada' : 'Calculated mass'}: ${m.toExponential(3)} kg (${(m/1e9).toFixed(2)} ${currentLang === 'es' ? 'millones de toneladas' : 'million tons'})</p>
  <p>${currentLang === 'es' ? 'Densidad' : 'Density'}: ${rho_i} kg/m¬≥</p>
</div>`;
    impactHtml+=`<div class="result-item">
      <strong>${t.targetDensity}</strong> ${rho_t.toFixed(0)} kg/m¬≥
      <div class="small">${t.source}: ${soilData.source}</div>
    </div>`;
    
    impactHtml+=`<div class="result-item">
      <strong>${t.energyReleased}</strong> ${megatonsTNT.toFixed(3)} ${t.megatonsTNT}
      <div class="small">${t.equivalent} ${(megatonsTNT*1000).toFixed(0)} ${t.hiroshimaBombs}</div>
    </div>`;
    
    impactHtml+=`<div class="result-item">
      <strong>${t.craterDiameter}</strong> ${D_final.toFixed(1)} ${t.meters}
      <div class="small">${t.radius} ${(D_final/2).toFixed(1)}m, ${t.estimatedDepth}: ${(D_final/5).toFixed(1)}m</div>
    </div>`;
    
    impactHtml+=`<div class="result-item"><strong>${t.airblast}</strong><ul class="small">`;
    for(const k in airblastDistances){
      const dist = Math.round(airblastDistances[k]);
      impactHtml+=`<li>${k}: ${dist >= 1000 ? (dist/1000).toFixed(2) + ' km' : dist + ' m'}</li>
      `;
    }
    impactHtml+=`</ul></div>`;
    
    impactHtml+=`<div class="result-item"><strong>${t.thermalRadiation}</strong><ul class="small">`;
    for(const k in thermal){
      const dist = Math.round(thermal[k]);
      impactHtml+=`<li>${k}: ${dist >= 1000 ? (dist/1000).toFixed(2) + ' km' : dist + ' m'}</li>`;
    }
    impactHtml+=`</ul></div>`;
    
    
    impactHtml+=`<div class="result-item">
      <strong>${t.impactLocation}</strong>
      <div class="location-info">
        ${locData.display_name}<br>
        <span class="small">${t.coordinates}: ${lat.toFixed(4)}¬∞, ${lon.toFixed(4)}¬∞</span><br>
        <span class="small">${t.ecosystem}: ${ecosystemData.icon} ${ecosystemData.type}</span>
      </div>
    </div>`;

    impactHtml+=`<div class="result-item">
      <strong>${t.riskAssessment}</strong>
      <ul class="small">
        <li>Tsunami: <span class="${getRiskClass(tsunamiRisk)}">${tsunamiRisk}</span></li>
        <li>${t.earthquake}: <span class="${getRiskClass(earthquakeRisk)}">${earthquakeRisk}</span> 
          <span class="small">(${eqData.total} ${t.estimatedQuakes}, ${eqData.highMag} M5+)</span>
        </li>
        <li>${t.fires}: <span class="${getRiskClass(fireRisk)}">${fireRisk}</span></li>
      </ul>
    </div>`;

    impactDiv.innerHTML = impactHtml;

    // ===== C√ÅLCULOS DE DESV√çO =====
    // ===== C√ÅLCULOS DE DESV√çO MEJORADOS =====
const T = toSeconds(timeYears);
const dv_req = displacement/T;
const dv_safe = dv_req*1.2; // 20% margen de seguridad

// M√âTODO 1: IMPACTO CIN√âTICO
let m_imp, v_imp, E_kinetic;
if(calcMethod === 'v'){
  v_imp = spacecraftValue;
  // F√≥rmula correcta considerando momento lineal y factor de mejora beta
  const beta = 1.5; // Factor de mejora por eyecci√≥n de material
  m_imp = (m*dv_req)/(beta*v_imp);
  E_kinetic = 0.5*m_imp*v_imp*v_imp;
}else{
  m_imp = spacecraftValue;
  const beta = 1.5;
  v_imp = (m*dv_req)/(beta*m_imp);
  E_kinetic = 0.5*m_imp*v_imp*v_imp;
}

// Tiempo de vuelo estimado (asumiendo trayectoria Hohmann simplificada)
const earth_distance = 1.496e11; // 1 AU en metros
const flight_time_years = Math.sqrt(Math.pow(displacement/earth_distance, 3)) * 0.5;
const mission_cost_estimate = (m_imp/1000) * 50000; // $50k por kg estimado

// M√âTODO 2: ABLACI√ìN L√ÅSER/SOLAR
const P = 5e6; // 5 MW de potencia (m√°s realista)
const efficiency = 0.3; // 30% eficiencia de conversi√≥n
const P_effective = P * efficiency;
const Lvap = 5e6; // Calor latente de vaporizaci√≥n (J/kg)
const vej = 3000; // Velocidad de eyecci√≥n del material vaporizado (m/s)
const mdot = P_effective/Lvap; // Tasa de ablaci√≥n de masa (kg/s)
const F = mdot*vej; // Fuerza de empuje (N)
const a = F/m; // Aceleraci√≥n del asteroide (m/s¬≤)
const dv_ab = a*T; // Cambio de velocidad alcanzado

// Masa total ablacionada
const mass_ablated = mdot * T;
const mass_percent = (mass_ablated/m)*100;

// Energ√≠a total requerida
const E_total_ablation = P_effective * T;
const solar_panel_area = P / (1361 * 0.25); // Asumiendo 25% eficiencia y constante solar

// M√âTODO 3: TRACTOR GRAVITACIONAL (bonus)
const m_tractor = 10000; // 10 toneladas
const G = 6.674e-11;
const separation = 100; // metros de separaci√≥n
const F_grav = G * m * m_tractor / (separation * separation);
const a_grav = F_grav / m;
const dv_grav = a_grav * T;

// Evaluaci√≥n de factibilidad
const kinetic_feasible = (v_imp < 15000 && m_imp < 10000 && E_kinetic < 1e12);
const ablation_feasible = (dv_ab >= dv_req && timeYears >= 5);
const grav_feasible = (timeYears >= 10 && m < 1e12);
window.ejectaDist = Object.values(airblastDistances)[0];

const kinStatus = kinetic_feasible ? t.meets : t.notMeets;
const ablStatus = ablation_feasible ? t.meets : t.notMeets;
const gravStatus = grav_feasible ? t.meets : t.notMeets;

let deflectionHtml = `
  <div class="result-item">
    <strong>üìê ${currentLang === 'es' ? 'Requisitos de Desv√≠o' : 'Deflection Requirements'}</strong>
    <p>Œîv ${t.required}: ${dv_req.toExponential(3)} m/s</p>
    <p>Œîv ${t.safety}: ${dv_safe.toExponential(3)} m/s (20% ${currentLang === 'es' ? 'margen' : 'margin'})</p>
    <p>${currentLang === 'es' ? 'Desplazamiento objetivo' : 'Target displacement'}: ${(displacement/1000).toFixed(0)} km</p>
    <p>${currentLang === 'es' ? 'Tiempo disponible' : 'Available time'}: ${timeYears} ${currentLang === 'es' ? 'a√±os' : 'years'} (${(T/(365.25*24*3600)).toFixed(1)} ${currentLang === 'es' ? 'a√±os' : 'years'})</p>
  </div>

  <div class="result-item">
    <strong>üöÄ ${t.kinetic}</strong>
    <p><strong>${t.proposal}:</strong></p>
    <ul class="small">
      <li>${currentLang === 'es' ? 'Masa de la nave' : 'Spacecraft mass'}: ${m_imp.toExponential(3)} kg (${(m_imp/1000).toFixed(2)} ${currentLang === 'es' ? 'toneladas' : 'tons'})</li>
      <li>${currentLang === 'es' ? 'Velocidad de impacto' : 'Impact velocity'}: ${v_imp.toExponential(3)} m/s (${(v_imp/1000).toFixed(2)} km/s)</li>
      <li>${t.kineticEnergy}: ${E_kinetic.toExponential(3)} J (${(E_kinetic/4.184e9).toFixed(2)} ${currentLang === 'es' ? 'toneladas TNT' : 'tons TNT'})</li>
      <li>${currentLang === 'es' ? 'Factor de mejora (Œ≤)' : 'Enhancement factor (Œ≤)'}: 1.5 (${currentLang === 'es' ? 'por eyecci√≥n' : 'from ejecta'})</li>
      <li>${currentLang === 'es' ? 'Tiempo de vuelo estimado' : 'Estimated flight time'}: ${flight_time_years.toFixed(2)} ${currentLang === 'es' ? 'a√±os' : 'years'}</li>
    </ul>
    <p><strong>Status:</strong> <span class="${kinStatus === t.meets ? 'pass' : 'fail'}">${kinStatus}</span></p>
    <p class="small">${currentLang === 'es' 
      ? (kinetic_feasible ? '‚úì Par√°metros dentro de rangos factibles' : '‚úó Requiere valores extremos - considerar alternativas')
      : (kinetic_feasible ? '‚úì Parameters within feasible ranges' : '‚úó Requires extreme values - consider alternatives')
    }</p>
  </div>
  
  <div class="result-item">
    <strong>‚òÄÔ∏è ${t.ablation}</strong>
    <p><strong>${currentLang === 'es' ? 'Sistema propuesto' : 'Proposed system'}:</strong></p>
    <ul class="small">
      <li>${currentLang === 'es' ? 'Potencia l√°ser' : 'Laser power'}: ${(P/1e6).toFixed(1)} MW (${currentLang === 'es' ? 'efectiva' : 'effective'}: ${(P_effective/1e6).toFixed(2)} MW)</li>
      <li>${currentLang === 'es' ? 'Eficiencia de conversi√≥n' : 'Conversion efficiency'}: ${(efficiency*100).toFixed(0)}%</li>
      <li>${currentLang === 'es' ? 'Tasa de ablaci√≥n' : 'Ablation rate'}: ${mdot.toExponential(3)} kg/s</li>
      <li>${currentLang === 'es' ? 'Fuerza de empuje' : 'Thrust force'}: ${F.toExponential(3)} N</li>
      <li>${currentLang === 'es' ? 'Aceleraci√≥n del asteroide' : 'Asteroid acceleration'}: ${a.toExponential(3)} m/s¬≤</li>
      <li>Œîv ${t.achieved}: ${dv_ab.toExponential(3)} m/s</li>
      <li>${currentLang === 'es' ? 'Masa ablacionada total' : 'Total ablated mass'}: ${mass_ablated.toExponential(3)} kg (${mass_percent.toFixed(4)}% ${currentLang === 'es' ? 'del asteroide' : 'of asteroid'})</li>
      <li>${currentLang === 'es' ? '√Årea de paneles solares' : 'Solar panel area'}: ${solar_panel_area.toFixed(0)} m¬≤</li>
      <li>${currentLang === 'es' ? 'Energ√≠a total requerida' : 'Total energy required'}: ${E_total_ablation.toExponential(3)} J</li>
    </ul>
    <p><strong>Status:</strong> <span class="${ablStatus === t.meets ? 'pass' : 'fail'}">${ablStatus}</span></p>
    <p class="small">${currentLang === 'es'
      ? (ablation_feasible ? '‚úì Factible con tiempo suficiente (‚â•5 a√±os recomendado)' : '‚úó Requiere m√°s tiempo de anticipaci√≥n')
      : (ablation_feasible ? '‚úì Feasible with sufficient time (‚â•5 years recommended)' : '‚úó Requires more lead time')
    }</p>
  </div>

  <div class="result-item">
    <strong>üõ∞Ô∏è ${currentLang === 'es' ? 'Tractor Gravitacional' : 'Gravity Tractor'}</strong>
    <ul class="small">
      <li>${currentLang === 'es' ? 'Masa de la nave' : 'Spacecraft mass'}: ${m_tractor} kg</li>
      <li>${currentLang === 'es' ? 'Distancia de separaci√≥n' : 'Separation distance'}: ${separation} m</li>
      <li>${currentLang === 'es' ? 'Fuerza gravitacional' : 'Gravitational force'}: ${F_grav.toExponential(3)} N</li>
      <li>${currentLang === 'es' ? 'Aceleraci√≥n inducida' : 'Induced acceleration'}: ${a_grav.toExponential(3)} m/s¬≤</li>
      <li>Œîv ${t.achieved}: ${dv_grav.toExponential(3)} m/s</li>
      <li>${currentLang === 'es' ? 'Tiempo de operaci√≥n continua' : 'Continuous operation time'}: ${timeYears} ${currentLang === 'es' ? 'a√±os' : 'years'}</li>
    </ul>
    <p><strong>Status:</strong> <span class="${gravStatus === t.meets ? 'pass' : 'fail'}">${gravStatus}</span></p>
    <p class="small">${currentLang === 'es'
      ? (grav_feasible ? '‚úì M√©todo m√°s lento pero m√°s seguro (ideal ‚â•10 a√±os)' : '‚úó No factible para este escenario')
      : (grav_feasible ? '‚úì Slowest but safest method (ideal ‚â•10 years)' : '‚úó Not feasible for this scenario')
    }</p>
  </div>
`;

deflectionDiv.innerHTML = deflectionHtml;

// ===== COMPARACI√ìN DE M√âTODOS MEJORADA =====
const methodsHtml = `
  <div class="method-card">
    <h4>üöÄ ${t.kinetic}</h4>
    <div class="pros-cons">
      <div class="pros">
        <h5>‚úì ${t.advantages}</h5>
        <ul class="small">
          <li>${currentLang === 'es' ? 'Tecnolog√≠a probada (misi√≥n DART 2022)' : 'Proven technology (DART mission 2022)'}</li>
          <li>${currentLang === 'es' ? 'Efecto inmediato y medible' : 'Immediate and measurable effect'}</li>
          <li>${currentLang === 'es' ? 'No requiere operaci√≥n continua' : 'No continuous operation required'}</li>
          <li>${currentLang === 'es' ? 'Factor de mejora por eyecci√≥n (Œ≤ ‚âà 1.5-3)' : 'Enhancement from ejecta (Œ≤ ‚âà 1.5-3)'}</li>
          <li>${currentLang === 'es' ? 'Misi√≥n relativamente corta' : 'Relatively short mission'}</li>
        </ul>
      </div>
      <div class="cons">
        <h5>‚úó ${t.disadvantages}</h5>
        <ul class="small">
          <li>${currentLang === 'es' ? 'Riesgo de fragmentaci√≥n del asteroide' : 'Risk of asteroid fragmentation'}</li>
          <li>${currentLang === 'es' ? 'Requiere precisi√≥n extrema en punter√≠a' : 'Requires extreme targeting precision'}</li>
          <li>${currentLang === 'es' ? 'Depende de composici√≥n del asteroide' : 'Depends on asteroid composition'}</li>
          <li>${currentLang === 'es' ? 'Una sola oportunidad de impacto' : 'Single impact opportunity'}</li>
          <li>${currentLang === 'es' ? 'Alto costo de lanzamiento ($50k-100k/kg)' : 'High launch cost ($50k-100k/kg)'}</li>
          <li>${currentLang === 'es' ? 'Efectividad incierta sin caracterizaci√≥n previa' : 'Uncertain effectiveness without prior characterization'}</li>
        </ul>
      </div>
    </div>
  </div>
  
  <div class="method-card">
    <h4>‚òÄÔ∏è ${t.ablation}</h4>
    <div class="pros-cons">
      <div class="pros">
        <h5>‚úì ${t.advantages}</h5>
        <ul class="small">
          <li>${currentLang === 'es' ? 'Empuje continuo y ajustable en tiempo real' : 'Continuous and real-time adjustable thrust'}</li>
          <li>${currentLang === 'es' ? 'Nave mucho m√°s ligera (~500-1000 kg)' : 'Much lighter spacecraft (~500-1000 kg)'}</li>
          <li>${currentLang === 'es' ? 'Menor costo de lanzamiento' : 'Lower launch cost'}</li>
          <li>${currentLang === 'es' ? 'No riesgo de fragmentaci√≥n' : 'No fragmentation risk'}</li>
          <li>${currentLang === 'es' ? 'Permite correcciones de trayectoria' : 'Allows trajectory corrections'}</li>
          <li>${currentLang === 'es' ? 'Puede usar energ√≠a solar (aut√≥nomo)' : 'Can use solar power (autonomous)'}</li>
        </ul>
      </div>
      <div class="cons">
        <h5>‚úó ${t.disadvantages}</h5>
        <ul class="small">
          <li>${currentLang === 'es' ? 'Requiere d√©cadas de anticipaci√≥n (>5-10 a√±os)' : 'Requires decades of lead time (>5-10 years)'}</li>
          <li>${currentLang === 'es' ? 'Tecnolog√≠a l√°ser de alta potencia no madura' : 'High-power laser technology not mature'}</li>
          <li>${currentLang === 'es' ? 'Dif√≠cil mantener enfoque preciso' : 'Difficult to maintain precise focus'}</li>
          <li>${currentLang === 'es' ? 'Eficiencia limitada (~30%)' : 'Limited efficiency (~30%)'}</li>
          <li>${currentLang === 'es' ? 'Vulnerabilidad: misi√≥n larga aumenta riesgo de fallo' : 'Vulnerability: long mission increases failure risk'}</li>
          <li>${currentLang === 'es' ? 'Rotaci√≥n del asteroide complica el proceso' : 'Asteroid rotation complicates process'}</li>
        </ul>
      </div>
    </div>
  </div>

  <div class="method-card">
    <h4>üõ∞Ô∏è ${currentLang === 'es' ? 'Tractor Gravitacional' : 'Gravity Tractor'}</h4>
    <div class="pros-cons">
      <div class="pros">
        <h5>‚úì ${t.advantages}</h5>
        <ul class="small">
          <li>${currentLang === 'es' ? 'M√©todo m√°s seguro - sin contacto f√≠sico' : 'Safest method - no physical contact'}</li>
          <li>${currentLang === 'es' ? 'Cero riesgo de fragmentaci√≥n' : 'Zero fragmentation risk'}</li>
          <li>${currentLang === 'es' ? 'Control preciso y continuo de la trayectoria' : 'Precise and continuous trajectory control'}</li>
          <li>${currentLang === 'es' ? 'Independiente de composici√≥n del asteroide' : 'Independent of asteroid composition'}</li>
          <li>${currentLang === 'es' ? 'Permite ajustes en tiempo real' : 'Allows real-time adjustments'}</li>
          <li>${currentLang === 'es' ? 'Tecnolog√≠a de propulsi√≥n existente (ion)' : 'Existing propulsion technology (ion)'}</li>
        </ul>
      </div>
      <div class="cons">
        <h5>‚úó ${t.disadvantages}</h5>
        <ul class="small">
          <li>${currentLang === 'es' ? 'Extremadamente lento - requiere d√©cadas (>10-15 a√±os)' : 'Extremely slow - requires decades (>10-15 years)'}</li>
          <li>${currentLang === 'es' ? 'Solo factible para asteroides peque√±os (<500m)' : 'Only feasible for small asteroids (<500m)'}</li>
          <li>${currentLang === 'es' ? 'Requiere operaci√≥n continua por a√±os' : 'Requires continuous operation for years'}</li>
          <li>${currentLang === 'es' ? 'Alto consumo de combustible/propelente' : 'High fuel/propellant consumption'}</li>
          <li>${currentLang === 'es' ? 'Costo operacional muy alto' : 'Very high operational cost'}</li>
          <li>${currentLang === 'es' ? 'Fuerza gravitacional d√©bil (‚àù 1/r¬≤)' : 'Weak gravitational force (‚àù 1/r¬≤)'}</li>
        </ul>
      </div>
    </div>
  </div>
`;

document.getElementById('methodsComparison').innerHTML = methodsHtml;    
  }catch(error){
    impactDiv.innerHTML = `<div class="result-item" style="border-left-color:#ef4444">
      <strong>‚ùå ${currentLang === 'es' ? 'Error en el c√°lculo' : 'Calculation error'}</strong><br>
      <span class="small">${error.message}</span>
    </div>`;
    deflectionDiv.innerHTML = impactDiv.innerHTML;
  }finally{
    loadingImpact.classList.remove('active');
    loadingDeflection.classList.remove('active');
  }
  let allAsteroids = [];

async function fetchAsteroids(pages = 3) {
    allAsteroids = [];
    for (let i = 0; i < pages; i++) {
        const response = await fetch(`/asteroids?page=${i}`);
        if (!response.ok) continue;
        const data = await response.json();
        if (!data) continue;
        allAsteroids = allAsteroids.concat(data.near_earth_objects);
    }
}

// Llama a la funci√≥n al cargar la p√°gina
fetchAsteroids(3);

// Funci√≥n para buscar y mostrar resultados

}

document.getElementById('calcBtn').addEventListener('click', calculateAll);
</script>
  <script type="text/javascript" src="lib/Detector.js"></script>
  <script type="text/javascript" src="lib/three.min.js"></script>
  <script type="text/javascript" src="lib/Tween.js"></script>
  <script type="text/javascript" src="lib/jquery-2.1.0.min.js"></script>
  <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
  <script type="text/javascript" src="globe.js"></script>
  <script type="text/javascript" src="main.js"></script>
    <script type="text/javascript" src="exctract.js"></script>

  
</body>
</html>