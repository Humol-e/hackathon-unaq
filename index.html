<!DOCTYPE HTML>
<html lang="en">
<head>
  <title>Music Globe</title>
  <meta charset="utf-8">
  <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
  <link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>

  <div id="container"></div>

  <div id="info">
    <strong>Based on <a href="http://www.chromeexperiments.com/globe">WebGL Globe</a></strong> <span class="bull">&bull;</span> Data from bandsintown API</a>
  </div>


  <div id="title">
    <div class="input-group">
      <input id="artistName" type="text" class="form-control" placeholder="Artist">
      <span class="input-group-btn">
        <button id="searchBtn" class="btn btn-default" type="button">Search</button>
      </span>
    </div>

    <ul id="top10" class="list-group"></ul>

  </div>

  <script type="text/javascript" src="lib/Detector.js"></script>
  <script type="text/javascript" src="lib/three.min.js"></script>
  <script type="text/javascript" src="lib/Tween.js"></script>
  <script type="text/javascript" src="lib/jquery-2.1.0.min.js"></script>
  <script type="text/javascript" src="globe.js"></script>
  <script type="text/javascript">

    if(!Detector.webgl){
      Detector.addGetWebGLMessage();
    } else {

      var container = document.getElementById('container');
      var globe = new DAT.Globe(container);

      function fetchData(artist) {
        var url = 'http://api.bandsintown.com/artists/' + artist + '/events.json?api_version=2.0&app_id=YOUR_APP_ID&date=all';
        $.get(url, {}, function (data) {
          var globeDataLL = [];
          var cities = {};
          // first pass
          for (var i = 0; i < data.length; i++) {
            var city = data[i].venue.city;
            if (!cities.hasOwnProperty(city)) {
              cities[city] = 0;
            }
            cities[data[i].venue.city] += 1;
          }

          var top = Object.keys(cities).map(function(c) { return {city: c, n: cities[c]}; }).sort(function (a, b) {
            return b.n - a.n;
          });
          var scale = 1 / top[0].n;

          $('#top10').empty();
          var topHtml = '';
          for (var i = 0; i < 10 && i < top.length; i++) {
            topHtml += '<li class="list-group-item"> <span class="badge">' + top[i].n + '</span> ' + top[i].city + ' </li>';
          }

          $('#top10').append(topHtml);

          if (max.n === 0) return;

          for (var i = 0; i < data.length; i++) {
          	var venue = data[i].venue;
          	globeDataLL = globeDataLL.concat([parseFloat(venue.latitude), parseFloat(venue.longitude), cities[venue.city] * scale]);
          }

          globe.addData(globeDataLL, {format: 'magnitude'});
          globe.createPoints();
          $('#top10').fadeIn();

        }, 'jsonp');
      }
    }

    $("#searchBtn").click(function () {
      var name = $("#artistName").val();
      globe.reset();
      $('#top10').fadeOut();
      fetchData(name);
    });


     globe.animate();

  </script>


  <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/lodash.js/2.4.1/lodash.min.js"></script>
</body>

</html>
